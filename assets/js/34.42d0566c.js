(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{388:function(s,a,t){"use strict";t.r(a);var e=t(25),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"операции-приnожения"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#операции-приnожения"}},[s._v("#")]),s._v(" Операции приложения")]),s._v(" "),t("p",[t("em",[s._v("Перейдите к "),t("a",{attrs:{href:"https://github.com/MuntashirAkon/AppManager/issues/17",target:"_blank",rel:"noopener noreferrer"}},[s._v("похожей проблеме"),t("OutboundLink")],1),s._v(" для обсуждения.")])]),s._v(" "),t("details",{staticClass:"custom-block details"},[t("summary",[s._v("Таблица содержания")]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#фоновый-режим"}},[s._v("Фоновый режим")])]),t("li",[t("a",{attrs:{href:"#знакомство-с-операциями-приnожений"}},[s._v("Знакомство с операциями приложений")])]),t("li",[t("a",{attrs:{href:"#диспетчер-операций-приnожений"}},[s._v("Диспетчер операций приложений")]),t("ul",[t("li",[t("a",{attrs:{href:"#константы-op"}},[s._v("Константы OP_*")])]),t("li",[t("a",{attrs:{href:"#константы-mode"}},[s._v("Константы MODE_*")])]),t("li",[t("a",{attrs:{href:"#операции-пакетов"}},[s._v("Операции пакетов")])]),t("li",[t("a",{attrs:{href:"#opentry"}},[s._v("OpEntry")])]),t("li",[t("a",{attrs:{href:"#испоnьзование"}},[s._v("Использование")])])])]),t("li",[t("a",{attrs:{href:"#сnужба-appopsservice"}},[s._v("Служба AppOpsService")])]),t("li",[t("a",{attrs:{href:"#appops-xml"}},[s._v("appops.xml")])]),t("li",[t("a",{attrs:{href:"#интерфейс-командной-строки-appops"}},[s._v("Интерфейс командной строки appops")])])])]),t("p")]),s._v(" "),t("h2",{attrs:{id:"фоновый-режим"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#фоновый-режим"}},[s._v("#")]),s._v(" Фоновый режим")]),s._v(" "),t("p",[t("strong",[s._v("Операции приложения")]),s._v(" используются системой Android (начиная с Android 4.3) для управления разрешениями приложений. Пользователь "),t("em",[s._v("может")]),s._v(" контролировать некоторые разрешения, но только те разрешения, которые считаются опасными (однако Google считает, что знание вашего номера телефона не опасно). Итак, кажется, что операции приложений – это то, что нам нужно, если мы хотим устанавливать такие приложения, как Facebook, Facebook Messenger (который буквально записывает все), и все еще хотим "),t("em",[s._v("немного")]),s._v(" приватности и/или безопасности. Хотя некоторые функции приложений были доступны в настройках, а затем в скрытых настройках в более старых версиях Android, в новых версиях Android они полностью скрыты и продолжают оставаться скрытыми. Теперь любое приложение с разрешением "),t("strong",[s._v("android.Manifest.permission.GET_APP_OPS_STATS")]),s._v(" может получать информацию об операциях приложения для других приложений, но это разрешение скрыто от пользователей и может быть включено только с помощью ADB или root. Тем не менее, приложение с этим разрешением не может предоставлять или отзывать разрешения (фактически режим операции) для приложений, отличных от себя (конечно, с ограниченными возможностями). Для изменения операции другого приложения, приложению необходимо разрешение "),t("strong",[s._v("android.Manifest.permission.UPDATE_APP_OPS_STATS")]),s._v(", которое недоступно через команду "),t("em",[s._v("pm")]),s._v(". Таким образом, вы не можете предоставить его через root или ADB, разрешение предоставляется только системным приложениям. Очень мало приложений, которые поддерживают отключение разрешений через операции приложения. Насколько мне известно, лучшее среди них это "),t("a",{attrs:{href:"https://github.com/8enet/AppOpsX",target:"_blank",rel:"noopener noreferrer"}},[s._v("AppOpsX"),t("OutboundLink")],1),s._v(". Основное (видимое) различие между моим приложением (App Manager) и этим приложением заключается в том, что последнее также предоставляет вам возможность отменять разрешения в интернете (путем написания таблиц IP). Другое отличие состоит в том, что автор использовал скрытый API для доступа/предоставления/отзыва операций, тогда как я использовал инструмент командой строки "),t("a",{attrs:{href:"#%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D0%BD%D0%BE%D0%B9-%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B8-appops"}},[t("em",[s._v("appops")])]),s._v(" для этого. Я сделал это из-за предела "),t("a",{attrs:{href:"https://stackoverflow.com/questions/37628",target:"_blank",rel:"noopener noreferrer"}},[s._v("рефлексии"),t("OutboundLink")],1),s._v("< недавно введенной в Android, которая сделала многие скрытые API непригодными для использования (есть некоторые хаки, но они могут не работать после выхода финальной версии Android R). Одна из важнейших проблем, с которыми я столкнулся при разработке API раздела операций приложений, – это отсутствие документации на английском языке.")]),s._v(" "),t("h2",{attrs:{id:"знакомство-с-операциями-приnожений"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#знакомство-с-операциями-приnожений"}},[s._v("#")]),s._v(" Знакомство с операциями приложений")]),s._v(" "),t("img",{attrs:{src:s.$withBase("/assets/how_app_ops_work.png"),alt:"Как работают операции приложений"}}),s._v(" "),t("p",[s._v("Фигура (взята из "),t("a",{attrs:{href:"https://translate.googleusercontent.com/translate_c?depth=2&pto=aue&rurl=translate.google.com&sl=auto&sp=nmt4&tl=en&u=https://www.cnblogs.com/0616--ataozhijia/p/5009718.html&usg=ALkJrhgSo4IcKp2cXJlqttXuiRJZGa_jnw",target:"_blank",rel:"noopener noreferrer"}},[s._v("этой статьи"),t("OutboundLink")],1),s._v(") выше описывает процесс изменения и обработки разрешения. "),t("a",{attrs:{href:"#%D0%B4%D0%B8%D1%81%D0%BF%D0%B5%D1%82%D1%87%D0%B5%D1%80-%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B9-%D0%BF%D1%80%D0%B8n%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9"}},[t("strong",[s._v("Диспетчер операций приложений")])]),s._v(' можно использовать для управления разрешениями в приложении "Настройки". '),t("strong",[s._v("Диспетчер операций приложений")]),s._v(" также полезен при определении того, предоставлено ли приложению определенное разрешение (или операция). Большинство методов "),t("strong",[s._v("диспетчера операций приложений")]),s._v(" доступны для пользовательских приложений, но в отличие от системных приложений, их можно использовать только для проверки разрешений для любого приложения или для самого приложения, а также для запуска или завершения определенных операций. Более того, не все операции фактически доступны из этого класса Java. "),t("strong",[s._v("Диспетчер операций приложений")]),s._v(" содержит все необходимые константы, такие как "),t("a",{attrs:{href:"#%D0%BA%D0%BE%D0%BD%D1%81%D1%82%D0%B0%D0%BD%D1%82%D1%8B-op"}},[t("em",[s._v("OP_*")])]),s._v(", "),t("code",[s._v("OPSTR_*")]),s._v(", "),t("a",{attrs:{href:"#%D0%BA%D0%BE%D0%BD%D1%81%D1%82%D0%B0%D0%BD%D1%82%D1%8B-mode"}},[t("em",[s._v("MODE_*")])]),s._v(", которые описывают код операции, строку операции и режим работы соответственно. Он также содержит необходимые структуры данных, такие как "),t("a",{attrs:{href:"#%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8-%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2"}},[t("strong",[s._v("PackageOps")])]),s._v(" и "),t("strong",[s._v("OpEntry")]),s._v(". "),t("strong",[s._v("PackageOps")]),s._v(" держит "),t("strong",[s._v("OpEntry")]),s._v(" длч пакета, и "),t("strong",[s._v("OpEntry")]),s._v(", как следует из названия, описывает каждую операцию. Под влиянием, "),t("strong",[s._v("AppOpsManager")]),s._v(" вызывает службу "),t("strong",[s._v("AppOpsService")]),s._v(" выполнять любую реальную работу.")]),s._v(" "),t("p",[s._v("Служба "),t("a",{attrs:{href:"https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/appop/AppOpsService.java",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[s._v("AppOpService")]),t("OutboundLink")],1),s._v(" полностью скрыта для пользовательских приложений, но доступна для системных. Как видно на рисунке, это класс, который выполняет фактическое управление. Он содержит такие структуры данных, как "),t("strong",[s._v("операции")]),s._v(" для хранения базовой информации о пакете и "),t("strong",[s._v("операцию")]),s._v(" что похоже на "),t("strong",[s._v("OpEntry")]),s._v(" из "),t("strong",[s._v("AppOpsManager")]),s._v(". Он также имеет "),t("strong",[s._v("оболочку")]),s._v(" которая на самом деле является исходным кодом инструмента командной строки_appops_. Он записывает или считывает конфигурации из "),t("a",{attrs:{href:"#appops-xml"}},[s._v("/data/system/appops.xml")]),s._v(". Системные службы вызывают "),t("strong",[s._v("AppOpsService")]),s._v(", чтобы узнать, какие приложения разрешены, а какие не разрешены, а "),t("strong",[s._v("AppOpsService")]),s._v(" определяет эти разрешения путем анализа "),t("code",[s._v("/data/system/appops.xml")]),s._v(". Если пользовательские значения не заданы в "),t("em",[s._v("appops.xml")]),s._v(", он возвращает режим по умолчанию, доступный в "),t("strong",[s._v("AppOpsManager")]),s._v(".")]),s._v(" "),t("h2",{attrs:{id:"диспетчер-операций-приnожений"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#диспетчер-операций-приnожений"}},[s._v("#")]),s._v(" Диспетчер операций приложений")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/app/AppOpsManager.java",target:"_blank",rel:"noopener noreferrer"}},[s._v("Диспетчер операций"),t("OutboundLink")],1),s._v(", он же диспетчер операций приложения. Он содержит в себе различные константы и классы для редактирования операций приложений. Официальную документацию можно найти "),t("a",{attrs:{href:"https://developer.android.com/reference/android/app/AppOpsManager",target:"_blank",rel:"noopener noreferrer"}},[s._v("здесь"),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("h3",{attrs:{id:"константы-op"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#константы-op"}},[s._v("#")]),s._v(" Константы OP_*")]),s._v(" "),t("p",[t("code",[s._v("OP_*")]),s._v(" – целые константы, начинающиеся с цифры "),t("code",[s._v("0")]),s._v(". "),t("code",[s._v("OP_NONE")]),s._v(" означает, что операции не определены, тогда как "),t("code",[s._v("_NUM_OP")]),s._v(" обозначает количество операций, определенных в префиксе "),t("code",[s._v("OP_*")]),s._v(".  Обозначает каждую операцию. Но эти операции не обязательно должны быть уникальными. Фактически, есть много операций, которые на самом деле являются одной операцией, обозначенной несколькими константами "),t("code",[s._v("OP_*")]),s._v(" (возможно для будущего использования). Надстройки могут определять свои собственные операции в зависимости от своих требований. MIUI – одна из известных надстроек, которая умеет это делать.")]),s._v(" "),t("p",[t("em",[s._v("Краткий обзор "),t("code",[s._v("OP_*")]),s._v(":")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" OP_NONE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" OP_COARSE_LOCATION "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" OP_FINE_LOCATION "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" OP_GPS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" OP_VIBRATE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" OP_READ_DEVICE_IDENTIFIERS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" OP_ACCESS_MEDIA_LOCATION "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" OP_ACTIVATE_PLATFORM_VPN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("91")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" _NUM_OP "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("92")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("Уникальность операции определяется значением "),t("a",{attrs:{href:"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=211?q=AppOpsManager&ss=android%2Fplatform%2Fsuperproject&gsn=sOpToSwitch&gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%238ffb80c9b09fce58d7fe1a0af7d50fd025765d8f41e838fa3bc2754dd99d9c48",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("sOpToSwitch")]),t("OutboundLink")],1),s._v(". Оно соотносит каждую операцию с другой операцией или с собой (если это уникальная операция). Например, "),t("code",[s._v("OP_FINE_LOCATION")]),s._v(" и "),t("code",[s._v("OP_GPS")]),s._v(" соотносится с "),t("code",[s._v("OP_COARSE_LOCATION")]),s._v(".")]),s._v(" "),t("p",[s._v("Каждая операция имеет личное имя, которое описывается значением "),t("a",{attrs:{href:"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=311?gsn=sOpNames&gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%234f77b221ad3e5d9212e217eadec0b78cd35717a3bf2d0f2bc642dea241e02d72",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("sOpNames")]),t("OutboundLink")],1),s._v(". Эти имена обычно совпадают с именами констант без префикса "),t("code",[s._v("OP_")]),s._v(". Некоторые операции также имеют публичные имена, которые описываются "),t("code",[s._v("sOpToString")]),s._v(". Например, "),t("code",[s._v("OP_COARSE_LOCATION")]),s._v(" имеет публичное имя "),t("strong",[s._v("android:coarse_location")]),s._v(".")]),s._v(" "),t("p",[s._v("По мере постепенного процесса перемещения разрешений в операции приложений уже существует множество разрешений, определенных для некоторых операций. Эти разрешения сопоставляются с "),t("a",{attrs:{href:"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=361?gsn=sOpPerms&gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%23230bc1462b07a3c1575477761782a9d3537d75b4ea0a16748082c74f50bc2814",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("sOpPerms")]),t("OutboundLink")],1),s._v(". Например, разрешение "),t("strong",[s._v("android.Manifest.permission.ACCESS_COARSE_LOCATION")]),s._v(" сопоставлено с "),t("code",[s._v("OP_COARSE_LOCATION")]),s._v(". Некоторые операции могут не иметь связанных разрешений, которые имеют значения "),t("code",[s._v("null")]),s._v(".")]),s._v(" "),t("p",[s._v("Как описано в предыдущем разделе, операции, настроенные для приложения, хранятся в "),t("a",{attrs:{href:"#appops-xml"}},[s._v("/data/system/appops.xml")]),s._v(". Если операция не настроена, то будет ли система разрешать эту операцию, определяется из "),t("a",{attrs:{href:"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/AppOpsManager.java;drc=44cbdec292c6b234d94aae59257721cf499989ba;bpv=1;bpt=1;l=410?gsn=sOpDefaultMode&gs=kythe%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsuperproject%3Flang%3Djava%3Fpath%3Dandroid.app.AppOpsManager%23a8c8e4e247453a8ce329b2c1130f9c7a7f91e2b97d159c3e18c768b4d42f1b75",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("sOpDefaultMode")]),t("OutboundLink")],1),s._v(". В нем отображается "),t("em",[s._v("режим по умолчанию")]),s._v(" для каждой операции.")]),s._v(" "),t("h3",{attrs:{id:"константы-mode"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#константы-mode"}},[s._v("#")]),s._v(" Константы MODE_*")]),s._v(" "),t("p",[s._v("Константы "),t("code",[s._v("MODE_*")]),s._v(", а также целочисленные константы, начинаются с цифры "),t("code",[s._v("0")]),s._v(". Эти константы назначаются каждой операции, описывающей, авторизовано ли приложение для выполнения этой операции. Эти режимы обычно имеют связанные имена, такие как "),t("strong",[s._v("allow")]),s._v(" для "),t("code",[s._v("MODE_ALLOWED")]),s._v(", "),t("strong",[s._v("ignore")]),s._v(" для "),t("code",[s._v("MODE_IGNORED")]),s._v(", "),t("strong",[s._v("deny")]),s._v(" для "),t("code",[s._v("MODE_ERRORED")]),s._v(" (довольно мизономер), "),t("strong",[s._v("default")]),s._v(" для "),t("code",[s._v("MODE_DEFAULT")]),s._v(" и "),t("strong",[s._v("foreground")]),s._v(" для "),t("code",[s._v("MODE_FOREGROUND")]),s._v(".")]),s._v(" "),t("p",[t("em",[s._v("Стандартные режимы:")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * данному вызывающему абоненту разрешено выполнять данную операцию.\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" MODE_ALLOWED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * данному звонящему не разрешено выполнять данную операцию, и эта попытка должна\n * <em>молча потерпеть неудачу</em> (это не должно привести к сбою приложения).\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" MODE_IGNORED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * данному звонящему не разрешено выполнять данную операцию, и эта попытка должна\n * вызвать фатальную ошибку, обычно это {@link SecurityException}.\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" MODE_ERRORED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * данный звонящий должен использовать проверку безопасности по умолчанию. Этот режим обычно не используется\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" MODE_DEFAULT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * Специальный режим, который означает «разрешить, только когда приложение используется».\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" MODE_FOREGROUND "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("Помимо этих режимов по умолчанию, поставщики могут устанавливать собственные режимы, такие как "),t("code",[s._v("MODE_ASK")]),s._v(" (с именем "),t("strong",[s._v("ask")]),s._v("), который активно используется в MIUI. MIUI также использует некоторые другие режимы без каких-либо связанных с ними имен.")]),s._v(" "),t("h3",{attrs:{id:"операции-пакетов"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#операции-пакетов"}},[s._v("#")]),s._v(" Операции пакетов")]),s._v(" "),t("p",[t("strong",[s._v("AppOpsManager.PackageOps")]),s._v(" – это структура данных для хранения всех "),t("strong",[s._v("OpEntry")]),s._v(" пакета. Проще говоря, она хранит все настроенные операции для пакета.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PackageOps")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Parcelable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" mPackageName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" mUid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OpEntry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" mEntries"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("Как видно выше, в нем хранятся все "),t("strong",[s._v("OpEntry")]),s._v(" пакета, а также соответствующее имя пакета и его идентификатор пользователя ядра.")]),s._v(" "),t("h3",{attrs:{id:"opentry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#opentry"}},[s._v("#")]),s._v(" OpEntry")]),s._v(" "),t("p",[t("strong",[s._v("AppOpsManager.OpEntry")]),s._v(" – это структура данных, в которой хранится одна операция для любого пакета.")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OpEntry")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Parcelable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" mOp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" mRunning"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Mode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" mMode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Nullable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongSparseLongArray")]),s._v(" mAccessTimes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Nullable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongSparseLongArray")]),s._v(" mRejectTimes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Nullable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongSparseLongArray")]),s._v(" mDurations"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Nullable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongSparseLongArray")]),s._v(" mProxyUids"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Nullable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LongSparseArray")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" mProxyPackageNames"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("Здесь:")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("mOp")]),s._v(": обозначает одну из констант "),t("a",{attrs:{href:"#%D0%BA%D0%BE%D0%BD%D1%81%D1%82%D0%B0%D0%BD%D1%82%D1%8B-op"}},[t("code",[s._v("OP_*")])]),s._v(".")]),s._v(" "),t("li",[t("code",[s._v("mRunning")]),s._v(": выполняются ли операции (т. е, операция началась, но еще не завершена). Не все операции можно запустить или завершить таким образом.")]),s._v(" "),t("li",[t("code",[s._v("mMOde")]),s._v(": одна из констант "),t("a",{attrs:{href:"#%D0%BA%D0%BE%D0%BD%D1%81%D1%82%D0%B0%D0%BD%D1%82%D1%8B-mode"}},[t("code",[s._v("MODE_*")])]),s._v(".")]),s._v(" "),t("li",[t("code",[s._v("mAccessTimes")]),s._v(": хранит все доступные времена принятия")]),s._v(" "),t("li",[t("code",[s._v("mRejectTimes")]),s._v(": хранит все доступные времена отклонения")]),s._v(" "),t("li",[t("code",[s._v("mDurations")]),s._v(": все доступные длительности доступа, выполняемые с помощью "),t("code",[s._v("mRunning")]),s._v(" сообщат вам, как долго приложение выполняет определенную операцию.")]),s._v(" "),t("li",[t("code",[s._v("mProxyUids")]),s._v(": документация не найдена")]),s._v(" "),t("li",[t("code",[s._v("mProxyPackageNames")]),s._v(": документация не найдена")])]),s._v(" "),t("h3",{attrs:{id:"испоnьзование"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#испоnьзование"}},[s._v("#")]),s._v(" Использование")]),s._v(" "),t("p",[s._v("Список задач")]),s._v(" "),t("h2",{attrs:{id:"сnужба-appopsservice"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#сnужба-appopsservice"}},[s._v("#")]),s._v(" Служба AppOpsService")]),s._v(" "),t("p",[s._v("Список задач")]),s._v(" "),t("h2",{attrs:{id:"appops-xml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#appops-xml"}},[s._v("#")]),s._v(" appops.xml")]),s._v(" "),t("p",[s._v("Последний "),t("code",[s._v("appops.xml")]),s._v(" имеет следующий формат: (это DTD создано мной и никоим образом не идеально, имеет проблемы совместимости).")]),s._v(" "),t("div",{staticClass:"language-dtd line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("<!DOCTYPE app-ops [\n\n<!ELEMENT app-ops (uid|pkg)*>\n<!ATTLIST app-ops v CDATA #IMPLIED>\n\n<!ELEMENT uid (op)*>\n<!ATTLIST uid n CDATA #REQUIRED>\n\n<!ELEMENT pkg (uid)*>\n<!ATTLIST pkg n CDATA #REQUIRED>\n\n<!ELEMENT uid (op)*>\n<!ATTLIST uid\nn CDATA #REQUIRED\np CDATA #IMPLIED>\n\n<!ELEMENT op (st)*>\n<!ATTLIST op\nn CDATA #REQUIRED\nm CDATA #REQUIRED>\n\n<!ELEMENT st EMPTY>\n<!ATTLIST st\nn CDATA #REQUIRED\nt CDATA #IMPLIED\nr CDATA #IMPLIED\nd CDATA #IMPLIED\npp CDATA #IMPLIED\npu CDATA #IMPLIED>\n\n]>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("p",[s._v("Приведенные ниже инструкции следуют точному порядку, указанному выше:")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("app-ops")]),s._v(": корневой элемент. Оно может содержать любое количество "),t("code",[s._v("pkg")]),s._v(" или пакетов "),t("code",[s._v("uid")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("v")]),s._v(": (опционально, целое число) номер версии (по умолчанию: "),t("code",[s._v("NO_VERSION")]),s._v(" или "),t("code",[s._v("-1")]),s._v(")")])])]),s._v(" "),t("li",[t("code",[s._v("pkg")]),s._v(": информация о пакете магазинов. Оно может содержать любое количество "),t("code",[s._v("uid")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("n")]),s._v(": (обязательно, строка) название пакета")])])]),s._v(" "),t("li",[s._v("Пакет "),t("code",[s._v("uid")]),s._v(": хранит пакет или информацию о пакетах\n"),t("ul",[t("li",[t("code",[s._v("n")]),s._v(": (обязательно, целое число) идентификатор пользователя")])])]),s._v(" "),t("li",[t("code",[s._v("uid")]),s._v(": идентификатор пользователя пакета Оно может содержать любое количество "),t("code",[s._v("операций")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("n")]),s._v(": (обязательно, целое число) идентификатор пользователя")]),s._v(" "),t("li",[t("code",[s._v("p")]),s._v(": (необязательно, логический) указывает, является ли приложение приватным или системным")])])]),s._v(" "),t("li",[t("code",[s._v("op")]),s._v(": операция, которая может содержать "),t("code",[s._v("st")]),s._v(" или вообще ничего\n"),t("ul",[t("li",[t("code",[s._v("n")]),s._v(": (обязательно, целое число) имя операции в целом числе AppOpsManager.OP_*")]),s._v(" "),t("li",[t("code",[s._v("m")]),s._v(": (обязательно, целое число) режим операции AppOpsManager.MODE_*")])])]),s._v(" "),t("li",[t("code",[s._v("st")]),s._v(": состояние операции: выполняется ли операция, выполняется ли доступ, отклонено или запущено (недоступно в старых версиях)\n"),t("ul",[t("li",[t("code",[s._v("n")]),s._v(": (обязательно, длинное число) ключ, содержащий флаги и uid")]),s._v(" "),t("li",[t("code",[s._v("t")]),s._v(": (опционально, длинное число) время доступа (по умолчанию: "),t("code",[s._v("0")]),s._v(")")]),s._v(" "),t("li",[t("code",[s._v("r")]),s._v(": (опционально, длинное число) время отклонения (по умолчанию: "),t("code",[s._v("0")]),s._v(")")]),s._v(" "),t("li",[t("code",[s._v("d")]),s._v(": (опционально, длинное число) длительность доступа (по умолчанию: "),t("code",[s._v("0")]),s._v(")")]),s._v(" "),t("li",[t("code",[s._v("pp")]),s._v(": (опционально, строка) имя пакета прокси")]),s._v(" "),t("li",[t("code",[s._v("pu")]),s._v(": (опционально, целое число) uid пакета прокси")])])])]),s._v(" "),t("p",[s._v("Это определение можно найти на странице "),t("a",{attrs:{href:"https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/appop/AppOpsService.java",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[s._v("AppOpsService")]),t("OutboundLink")],1),s._v(".")]),s._v(" "),t("h2",{attrs:{id:"интерфейс-командной-строки-appops"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#интерфейс-командной-строки-appops"}},[s._v("#")]),s._v(" Интерфейс командной строки appops")]),s._v(" "),t("p",[t("code",[s._v("appops")]),s._v(" или "),t("code",[s._v("cmd appops")]),s._v(" (в последних версиях) могут быть доступны через ADB или root. Это более простой способ получить или обновить любую операцию для пакета (при условии, что имя пакета известно). Страница справки по этой команде не требует пояснений:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Команды службы AppOps (appops):\nhelp\n  Напишите этот текст для получения справки.\nstart [--user <USER_ID>] <PACKAGE | UID> <OP> \n  Запускает заданную операцию для определенного приложения.\nstop [--user <USER_ID>] <PACKAGE | UID> <OP> \n  Останавливает заданную операцию для определенного приложения.\nset [--user <USER_ID>] <[--uid] PACKAGE | UID> <OP> <MODE>\n  Устанавливает режим для конкретного приложения и операции.\nget [--user <USER_ID>] <PACKAGE | UID> [<OP>]\n  Возвращает режим для конкретного приложения и дополнительной операции.\nquery-op [--user <USER_ID>] <OP> [<MODE>]\n  Вывод всех пакетов, которые в данный момент имеют данную операцию в данном режиме.\nreset [--user <USER_ID>] [<PACKAGE>]\n  Сброс данного приложение или все приложения в режимы по умолчанию.\nwrite-settings\n  Немедленная запись ожидающих изменений в хранилище.\nread-settings\n  Чтение последних записанных настроек, заменив текущее состояние в ОЗУ.\nопции:\n  <PACKAGE> имя пакета Android или его UID, если перед ним стоит префикс --uid\n  <OP>      операция AppOps.\n  <MODE>    одно из разрешить, игнорировать, запретить или по умолчанию\n  <USER_ID> идентификатор пользователя, под которым установлен пакет. Если --user не указан\n            , предполагается текущий пользователь.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);